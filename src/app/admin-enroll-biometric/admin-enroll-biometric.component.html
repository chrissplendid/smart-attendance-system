<div class="container-fluid">
  <!-- Header -->
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-2 mb-3 mt-3"
  >
    <div>
      <p class="page-title mb-1">üñêÔ∏è Biometric Enrollment</p>
      <p class="sub-title mb-0">
        Admin only ‚Äî enroll fingerprint or face for users. Templates are stored
        encrypted; no raw images are kept.
      </p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary action-btn">Help</button>
      <button class="btn btn-success action-btn">Start Kiosk Enrollment</button>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="row row-gap mb-3">
    <div class="col-6 col-md-3 mt-3 mb-3">
      <div class="enroll-card bg-gradient-primary">
        <p class="stat-small mb-1">Enrolled Users</p>
        <h4 class="mb-0">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3 mt-3 mb-3">
      <div class="enroll-card bg-gradient-success">
        <p class="stat-small mb-1">Fingerprints</p>
        <h4 class="mb-0">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3 mt-3 mb-3">
      <div class="enroll-card bg-gradient-warning">
        <p class="stat-small mb-1">Face Templates</p>
        <h4 class="mb-0">0</h4>
      </div>
    </div>
    <div class="col-6 col-md-3 mt-3 mb-3">
      <div class="enroll-card">
        <p class="stat-small mb-1 text-muted">Last Enrollment</p>
        <h6 class="mb-0">Aug 27, 2025 ‚Äî 11:47 AM</h6>
      </div>
    </div>
  </div>

  <!-- Main enrollment area -->
  <div class="enroll-card enroll-grid">
    <!-- Left: Enrollment Controls -->
    <div>
      <!-- Instructions -->
      <div class="mb-3">
        <h6 class="fw-semibold mb-2">Enrollment Instructions</h6>
        <ol class="small mb-0 text-muted">
          <li>Select the user (searchable).</li>
          <li>Choose fingerprint or face enrollment (or both).</li>
          <li>Follow the on-screen prompts.</li>
          <li>
            On success, the template will be securely uploaded & encrypted.
          </li>
        </ol>
      </div>

      <!-- Enrollment Panel -->
      <div class="mb-3 enrollment-panel">
        <form
          [formGroup]="enrollForm"
          class="mb-3 space-y-4"
          (ngSubmit)="startEnrollment()"
        >
          <div class="mb-2">
            <label for="userSelect" class="form-label small">Select User</label>
            <select formControlName="user" class="form-select w-full">
              <option *ngFor="let u of users" [ngValue]="u">
                {{ u.firstname }} {{ u.lastname }} ‚Äî {{ u.email }}
              </option>
            </select>
          </div>

          <div class="d-flex gap-2 mb-3">
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="fingerprint"
                id="enrollFingerprint"
                checked
              />
              <label class="form-check-label small" for="enrollFingerprint"
                >Fingerprint</label
              >
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="face"
                id="enrollFace"
                checked
              />
              <label class="form-check-label small" for="enrollFace"
                >Face</label
              >
            </div>
          </div>

          <!-- Fingerprint status -->
          <div class="mb-3">
            <div class="fp-status align-items-center">
              <div class="fp-thumb">üñê</div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <small class="text-uppercase text-muted"
                      >Fingerprint Status</small
                    >
                    <div class="fw-semibold">{{ fingerprintStatus }}</div>
                  </div>
                  <div style="width: 40%">
                    <div class="progress">
                      <div class="progress-bar" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
                <small class="text-muted"
                  >Place finger on the kiosk scanner when prompted.</small
                >
              </div>
            </div>
          </div>

          <!-- Face status -->
          <!-- Face status -->
          <div class="mb-3">
            <small class="text-uppercase text-muted">Face Status</small>
            <div class="d-flex gap-2 align-items-center mt-2">
              <!-- Live Camera Preview -->
              <div class="camera-preview">
                <video
                  #videoEl
                  autoplay
                  muted
                  playsinline
                  width="240"
                  height="180"
                  class="border rounded"
                ></video>
              </div>

              <div class="divider"></div>

              <!-- Face Enrollment Status -->
              <div class="flex-grow-1">
                <div class="fw-semibold">{{ faceStatus }}</div>
                <small class="text-muted"
                  >Allow camera access when prompted.</small
                >
                <div class="mt-2">
                  <div class="progress">
                    <div
                      class="progress-bar bg-success"
                      [style.width.%]="faceProgress"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Controls -->
          <div class="d-flex flex-column flex-sm-row gap-2 mt-3">
            <button
              type="button"
              class="btn btn-primary w-100"
              (click)="startEnrollment()"
            >
              Start Enrollment
            </button>
            <button
              type="button"
              class="btn btn-outline-secondary w-100"
              (click)="abortEnrollment()"
            >
              Abort
            </button>
            <button
              type="button"
              class="btn btn-outline-info w-100"
              (click)="retryEnrollment()"
            >
              Retry
            </button>
            <button
              type="button"
              class="btn btn-outline-primary w-100"
              (click)="startAttendanceSign()"
            >
              Test Attendance Sign-In
            </button>
          </div>
        </form>
      </div>

      <!-- Logs -->
      <div class="p-2 log-panel">
        <div class="mt-4 text-red-600" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>
        <h6 class="small fw-semibold">Recent Enrollment Logs</h6>
        <ul class="list-unstyled small mb-0 text-muted">
          <li *ngFor="let log of logs">{{ log }}</li>
        </ul>
      </div>
    </div>

    <!-- Right: Kiosk Preview & Advanced Options -->
    <aside>
      <div class="mb-3">
        <h6 class="fw-semibold mb-2">Kiosk Preview</h6>
        <div class="enroll-card p-3 text-center">
          <div class="camera-preview mb-3">
            <div class="text-muted">
              <div class="fw-semibold">Kiosk Idle</div>
              <div class="small">Waiting for enrollment action</div>
            </div>
          </div>
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary">Open Kiosk App</button>
            <button class="btn btn-outline-secondary">
              Force Sync Templates
            </button>
            <button class="btn btn-outline-danger">Clear Local Cache</button>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <h6 class="fw-semibold mb-2">Advanced Options</h6>
        <div class="enroll-card p-2">
          <div class="d-flex justify-content-between mb-2">
            <small class="text-muted">Encryption</small>
            <small class="fw-semibold">AES-256</small>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <small class="text-muted">Template Type</small>
            <small class="fw-semibold">Embeddings / Fingerprint</small>
          </div>
          <div class="d-flex justify-content-between">
            <small class="text-muted">Upload Mode</small>
            <select class="form-select form-select-sm w-auto">
              <option value="realtime">Realtime (recommended)</option>
              <option value="batch">Batch (offline)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="small text-muted">
        <strong>Note:</strong> Face captures are converted to embeddings
        client-side; only hashed/encrypted templates are sent to the server.
      </div>
    </aside>
  </div>
</div>
